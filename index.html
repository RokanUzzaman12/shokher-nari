<!doctype html>
<html lang="bn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üíï ‡¶∂‡¶ñ‡ßá‡¶∞ ‡¶®‡¶æ‡¶∞‡ßÄ üíï</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Hind Siliguri", "Noto Sans Bengali", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
      }

      .chat-container {
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        background: #f5f0ff;
      }

      .message {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
      }

      .user-message {
        align-items: flex-end;
      }

      .bot-message {
        align-items: flex-start;
      }

      .message-bubble {
        max-width: 80%;
        padding: 12px 18px;
        border-radius: 25px;
        font-size: 1.1em;
        line-height: 1.4;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        word-wrap: break-word;
      }

      .user-message .message-bubble {
        background: #764ba2;
        color: white;
        border-bottom-right-radius: 5px;
      }

      .bot-message .message-bubble {
        background: #e0d0ff;
        color: #333;
        border-bottom-left-radius: 5px;
      }

      .message-time {
        font-size: 0.8em;
        color: #999;
        margin-top: 5px;
        margin-left: 10px;
        margin-right: 10px;
      }

      .input-area {
        padding: 20px;
        background: white;
        border-top: 2px solid #764ba2;
      }

      .voice-controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .voice-btn {
        background: #764ba2;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
      }

      .voice-btn:hover {
        background: #5a3d80;
        transform: translateY(-2px);
      }

      .voice-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .text-input-area {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .text-input {
        flex: 1;
        padding: 12px;
        border: 2px solid #e0d0ff;
        border-radius: 25px;
        font-size: 1.1em;
        font-family: "Hind Siliguri", sans-serif;
      }

      .send-btn {
        background: #764ba2;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1.1em;
        cursor: pointer;
      }

      .status {
        text-align: center;
        color: #764ba2;
        font-weight: bold;
        margin: 15px 0;
        min-height: 30px;
        font-size: 1.1em;
        background: #f0e6ff;
        padding: 10px;
        border-radius: 10px;
      }

      .suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin: 15px 0;
      }

      .suggestion-chip {
        background: #f0e6ff;
        color: #764ba2;
        padding: 8px 15px;
        border-radius: 25px;
        font-size: 0.95em;
        cursor: pointer;
        border: 1px solid #b19cd9;
        transition: all 0.3s ease;
      }

      .suggestion-chip:hover {
        background: #764ba2;
        color: white;
      }

      .footer {
        text-align: center;
        padding: 15px;
        background: #f0e6ff;
        color: #764ba2;
        font-size: 0.9em;
      }

      .listening-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin: 10px 0;
        padding: 10px;
        background: #ffebee;
        border-radius: 50px;
      }

      .wave {
        width: 5px;
        height: 20px;
        background: #ff4444;
        margin: 0 3px;
        border-radius: 5px;
        animation: wave 1s linear infinite;
      }

      .wave:nth-child(2) {
        animation-delay: 0.2s;
      }

      .wave:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes wave {
        0%,
        100% {
          transform: scaleY(1);
        }
        50% {
          transform: scaleY(2);
        }
      }

      .permission-status {
        background: #e3f2fd;
        border-radius: 10px;
        padding: 10px;
        margin: 10px 0;
        text-align: center;
        font-weight: bold;
      }

      .permission-status.granted {
        background: #d4edda;
        color: #155724;
      }

      .permission-status.denied {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üíï ‡¶∂‡¶ñ‡ßá‡¶∞ ‡¶®‡¶æ‡¶∞‡ßÄ AI üíï</h1>
      </div>

      <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
          <div class="message-bubble">üíï ‡¶π‡¶æ‡¶á ‡¶¨‡¶æ‡¶¨‡ßÅ! ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶® ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨!</div>
          <div class="message-time">‡¶†‡¶ø‡¶ï ‡¶è‡¶ñ‡¶®</div>
        </div>
      </div>

      <div class="input-area">
        <div id="permissionStatus" class="permission-status">
          ‚è≥ ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
        </div>

        <div class="voice-controls">
          <button class="voice-btn" id="startBtn" disabled>üé§ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button class="voice-btn" id="stopBtn" disabled>‚èπÔ∏è ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button class="voice-btn" id="permissionBtn" style="background: #28a745">
            üé§ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®
          </button>
        </div>

        <div class="listening-indicator" id="listeningIndicator" style="display: none">
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <span style="color: #ff4444; margin-left: 10px">‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø...</span>
        </div>

        <div class="text-input-area">
          <input type="text" id="textInput" class="text-input" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." />
          <button class="send-btn" id="sendBtn">üì® ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
        </div>

        <div class="status" id="status">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§...</div>

        <div class="suggestions" id="suggestions">
          <span class="suggestion-chip">üíï ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ?</span>
          <span class="suggestion-chip">ü•∞ ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶∞‡ßÄ‡¶∞ ‡¶Æ‡¶§</span>
          <span class="suggestion-chip">üòä ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø</span>
          <span class="suggestion-chip">üåô ‡¶ó‡ßÅ‡¶° ‡¶®‡¶æ‡¶á‡¶ü</span>
          <span class="suggestion-chip">‚òÄÔ∏è ‡¶ó‡ßÅ‡¶° ‡¶Æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç</span>
          <span class="suggestion-chip">üíù ‡¶Æ‡¶ø‡¶∏ ‡¶ï‡¶∞‡¶õ‡¶ø</span>
        </div>
      </div>

      <div class="footer">üíï GitHub Pages ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®</div>
    </div>

    <audio id="ttsAudio" class="audio-player" style="display: none"></audio>

    <script>
      // intentsData ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ existing ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
      const intentsData = {
        intents: [
          {
            tag: "how_are_you",
            patterns: ["‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ", "‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßã", "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ"],
            responses: [
              "‡¶Ü‡¶Æ‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ü‡¶õ‡¶ø, ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ?",
              "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶≠‡ßá‡¶¨‡ßá"
            ]
          },
          {
            tag: "compliment",
            patterns: ["‡¶™‡¶∞‡ßÄ", "‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞", "‡¶™‡¶∞‡ßÄ‡¶∞ ‡¶Æ‡¶§"],
            responses: [
              "‡¶π‡ßÅ‡¶∏.. ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶∂‡ßÅ‡¶®‡ßá ‡¶≤‡¶ú‡ßç‡¶ú‡¶æ ‡¶™‡ßá‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡¶æ‡¶Æ",
              "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ø‡¶ñ‡¶® ‡¶¨‡¶≤‡ßã ‡¶§‡¶ñ‡¶® ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡ßá"
            ]
          },
          {
            tag: "love",
            patterns: ["‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø", "‡¶Ü‡¶á ‡¶≤‡¶æ‡¶≠ ‡¶á‡¶â"],
            responses: [
              "‡¶Ü‡¶Æ‡¶ø‡¶ì ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶Ö‡¶®‡ßá‡¶ï ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø",
              "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ï‡¶æ‡¶õ‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑"
            ]
          },
          {
            tag: "greeting",
            patterns: ["‡¶π‡¶æ‡¶á", "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã", "‡¶ì‡¶π‡ßá"],
            responses: [
              "‡¶π‡¶æ‡¶á ‡¶¨‡¶æ‡¶¨‡ßÅ! ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßã?",
              "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã ‡¶ú‡¶æ‡¶®! ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶õ‡¶ø‡¶≤‡¶æ‡¶Æ"
            ]
          },
          {
            tag: "missing",
            patterns: ["‡¶Æ‡¶ø‡¶∏ ‡¶ï‡¶∞‡¶õ‡¶ø", "‡¶Æ‡¶ø‡¶∏ ‡¶á‡¶â"],
            responses: [
              "‡¶Ü‡¶Æ‡¶ø‡¶ì ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶Ö‡¶®‡ßá‡¶ï ‡¶Æ‡¶ø‡¶∏ ‡¶ï‡¶∞‡¶õ‡¶ø",
              "‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡¶õ‡ßá ‡¶®‡¶æ"
            ]
          },
          {
            tag: "default",
            patterns: [],
            responses: [
              "‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶∂‡ßÅ‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶ö‡ßç‡¶õ‡¶ø‡•§ ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡¶≤‡¶¨‡ßá?",
              "‡¶¨‡¶≤‡ßã ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßã‡¶®‡¶æ, ‡¶ï‡ßÄ ‡¶¨‡¶≤‡¶¨‡ßá?"
            ]
          }
        ]
      };

      // DOM Elements
      const chatContainer = document.getElementById("chatContainer");
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");
      const permissionBtn = document.getElementById("permissionBtn");
      const sendBtn = document.getElementById("sendBtn");
      const textInput = document.getElementById("textInput");
      const statusDiv = document.getElementById("status");
      const permissionStatus = document.getElementById("permissionStatus");
      const listeningIndicator = document.getElementById("listeningIndicator");
      const suggestionChips = document.querySelectorAll(".suggestion-chip");
      const ttsAudio = document.getElementById("ttsAudio");

      // Global variables
      let mediaStream = null;
      let isListening = false;
      let isSpeaking = false;
      let hasPermission = false;
      let recognition = null;

      //=========== ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡ßß: ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ TTS (‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶∏‡¶π‡¶ú) ===========
      function speakWithBrowserTTS(text) {
        if (isSpeaking) return;
        
        // ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶ï‡¶∞‡¶æ
        const cleanText = text.replace(/[^\u0980-\u09FF\u0964\u0965\u0020-\u007F]/g, "").trim();
        if (!cleanText) return;

        isSpeaking = true;
        statusDiv.textContent = "üîä ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶õ‡¶ø...";

        // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ built-in TTS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
        const utterance = new SpeechSynthesisUtterance(cleanText);
        utterance.lang = "bn-BD";
        utterance.rate = 0.9;
        utterance.pitch = 1;
        
        utterance.onend = () => {
          isSpeaking = false;
          statusDiv.textContent = isListening ? "üé§ ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø..." : "‚úÖ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§";
        };
        
        utterance.onerror = () => {
          isSpeaking = false;
          statusDiv.textContent = "‚ö†Ô∏è ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ";
        };

        window.speechSynthesis.speak(utterance);
      }

      //=========== ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡ß®: ResponsiveVoice (‡¶¨‡¶ø‡¶ï‡¶≤‡ßç‡¶™) ===========
      function loadResponsiveVoice() {
        if (!window.responsiveVoice) {
          const script = document.createElement("script");
          script.src = "https://code.responsivevoice.org/responsivevoice.js?key=H5YcRdI9";
          script.async = true;
          document.head.appendChild(script);
        }
      }

      function speakWithResponsiveVoice(text) {
        if (isSpeaking || !window.responsiveVoice) return;
        
        const cleanText = text.replace(/[^\u0980-\u09FF\u0964\u0965\u0020-\u007F]/g, "").trim();
        if (!cleanText) return;

        isSpeaking = true;
        statusDiv.textContent = "üîä ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶õ‡¶ø...";

        window.responsiveVoice.speak(cleanText, "Bengali Female", {
          pitch: 1,
          rate: 0.9,
          onend: () => {
            isSpeaking = false;
            statusDiv.textContent = isListening ? "üé§ ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø..." : "‚úÖ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§";
          }
        });
      }

      //=========== ‡¶Æ‡ßá‡¶á‡¶® TTS ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ===========
      function speak(text) {
        if (isSpeaking) return;

        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ResponsiveVoice ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá (‡¶Ø‡¶¶‡¶ø ‡¶≤‡ßã‡¶° ‡¶•‡¶æ‡¶ï‡ßá)
        if (window.responsiveVoice) {
          speakWithResponsiveVoice(text);
        } 
        // ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ TTS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá
        else {
          speakWithBrowserTTS(text);
        }
      }

      // Find best response
      function findBestResponse(userInput) {
        userInput = userInput.toLowerCase().trim();
        
        for (const intent of intentsData.intents) {
          for (const pattern of intent.patterns) {
            if (userInput.includes(pattern.toLowerCase())) {
              const responses = intent.responses;
              return responses[Math.floor(Math.random() * responses.length)];
            }
          }
        }
        
        const defaultIntent = intentsData.intents.find(i => i.tag === "default");
        if (defaultIntent) {
          const responses = defaultIntent.responses;
          return responses[Math.floor(Math.random() * responses.length)];
        }
        return "‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶∂‡ßÅ‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶ö‡ßç‡¶õ‡¶ø‡•§ ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡¶≤‡¶¨‡ßá?";
      }

      function addMessage(text, isUser = false) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message");
        messageDiv.classList.add(isUser ? "user-message" : "bot-message");

        const bubble = document.createElement("div");
        bubble.classList.add("message-bubble");
        bubble.textContent = text;

        const time = document.createElement("div");
        time.classList.add("message-time");
        const now = new Date();
        time.textContent = now.toLocaleTimeString("bn-BD", {
          hour: "2-digit",
          minute: "2-digit",
        });

        messageDiv.appendChild(bubble);
        messageDiv.appendChild(time);
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function processUserInput(userInput) {
        if (!userInput || userInput.trim() === "" || isSpeaking) return;

        addMessage(userInput, true);

        const botResponse = findBestResponse(userInput);
        console.log("Bot response:", botResponse);

        setTimeout(() => {
          addMessage(botResponse, false);
          // ‡ß´‡ß¶‡ß¶ms ‡¶™‡¶∞‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá
          setTimeout(() => {
            speak(botResponse);
          }, 300);
        }, 500);

        textInput.value = "";
      }

      // ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø
      async function getMicrophonePermission() {
        try {
          permissionStatus.textContent = "‚è≥ ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶ö‡¶æ‡¶ö‡ßç‡¶õ‡¶ø...";
          permissionStatus.className = "permission-status";

          mediaStream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
            },
          });

          hasPermission = true;
          permissionStatus.textContent = "‚úÖ ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!";
          permissionStatus.className = "permission-status granted";

          initializeRecognition();

          startBtn.disabled = false;
          statusDiv.textContent = '‚úÖ "‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®';

          permissionBtn.disabled = true;
          permissionBtn.style.opacity = "0.5";
          
          // ResponsiveVoice ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
          loadResponsiveVoice();
          
        } catch (error) {
          hasPermission = false;
          permissionStatus.textContent = "‚ùå ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø";
          permissionStatus.className = "permission-status denied";
        }
      }

      function initializeRecognition() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
          statusDiv.textContent = "‚ùå Speech Recognition ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ";
          return;
        }

        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.lang = "bn-BD";
        recognition.interimResults = false;

        recognition.onstart = () => {
          isListening = true;
          startBtn.disabled = true;
          stopBtn.disabled = false;
          listeningIndicator.style.display = "flex";
          statusDiv.textContent = "üé§ ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø... ‡¶è‡¶ñ‡¶® ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßÅ‡¶®";
        };

        recognition.onresult = (event) => {
          if (isSpeaking) return;
          
          const last = event.results.length - 1;
          const userInput = event.results[last][0].transcript;
          statusDiv.textContent = `‚úÖ ‡¶∂‡ßÅ‡¶®‡ßá‡¶õ‡¶ø: "${userInput}"`;
          processUserInput(userInput);
        };

        recognition.onerror = (event) => {
          if (event.error !== "no-speech") {
            console.error("Speech error:", event.error);
          }
        };

        recognition.onend = () => {
          if (isListening && hasPermission && !isSpeaking) {
            setTimeout(() => {
              try {
                recognition.start();
              } catch (e) {}
            }, 100);
          } else {
            updateUIForStopped();
          }
        };
      }

      function startListening() {
        if (!hasPermission || !mediaStream) {
          statusDiv.textContent = "‚ùì ‡¶Ü‡¶ó‡ßá ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®";
          return;
        }
        if (isListening) return;
        
        try {
          recognition.start();
        } catch (error) {
          console.error("Start error:", error);
        }
      }

      function stopListening() {
        isListening = false;
        if (recognition) {
          try {
            recognition.stop();
          } catch (e) {}
        }
        updateUIForStopped();
      }

      function updateUIForStopped() {
        startBtn.disabled = !hasPermission;
        stopBtn.disabled = true;
        listeningIndicator.style.display = "none";
        if (hasPermission) {
          statusDiv.textContent = '‚è∏Ô∏è ‡¶¨‡¶®‡ßç‡¶ß ‡¶Ü‡¶õ‡ßá‡•§ "‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
      }

      // Event Listeners
      permissionBtn.addEventListener("click", getMicrophonePermission);
      startBtn.addEventListener("click", startListening);
      stopBtn.addEventListener("click", stopListening);

      sendBtn.addEventListener("click", () => {
        processUserInput(textInput.value);
      });

      textInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          processUserInput(textInput.value);
        }
      });

      suggestionChips.forEach((chip) => {
        chip.addEventListener("click", () => {
          const text = chip.textContent.replace(/[üíïü•∞üòäüåô‚òÄÔ∏èüíù]/g, "").trim();
          processUserInput(text);
        });
      });

      window.addEventListener("beforeunload", () => {
        if (mediaStream) {
          mediaStream.getTracks().forEach((track) => track.stop());
        }
      });

      // ResponsiveVoice ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
      setTimeout(() => {
        if (!window.responsiveVoice) {
          console.log("ResponsiveVoice not loaded, using browser TTS only");
        }
      }, 3000);

      console.log("‚úÖ GitHub Pages ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶® ‡¶∞‡ßá‡¶°‡¶ø!");
    </script>
  </body>
</html>
